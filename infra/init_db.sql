CREATE EXTENSION IF NOT EXISTS vector;\n\n-- Canonical jobs table\nCREATE TABLE IF NOT EXISTS jobs (\n  id UUID PRIMARY KEY,\n  source TEXT NOT NULL,\n  company TEXT NOT NULL,\n  title TEXT NOT NULL,\n  location TEXT,\n  remote TEXT,\n  employment_type TEXT,\n  level TEXT,\n  posted_at TIMESTAMPTZ NOT NULL,\n  apply_url TEXT NOT NULL,\n  canonical_url TEXT,\n  currency TEXT,\n  salary_min NUMERIC,\n  salary_max NUMERIC,\n  salary_period TEXT,\n  description_md TEXT NOT NULL,\n  description_raw TEXT,\n  hash_sim TEXT NOT NULL,\n  meta JSONB,\n  created_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Analyses\nCREATE TABLE IF NOT EXISTS job_analyses (\n  id UUID PRIMARY KEY,\n  job_id UUID REFERENCES jobs(id) ON DELETE CASCADE,\n  resume_version TEXT,\n  fit_score INT CHECK (fit_score BETWEEN 0 AND 100),\n  strengths JSONB,\n  gaps JSONB,\n  ats_keywords JSONB,\n  rationale TEXT,\n  created_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Cover letters\nCREATE TABLE IF NOT EXISTS cover_letters (\n  id UUID PRIMARY KEY,\n  job_id UUID REFERENCES jobs(id) ON DELETE CASCADE,\n  resume_version TEXT,\n  variant TEXT CHECK (variant IN ('short','standard','long')) DEFAULT 'standard',\n  tone TEXT,\n  letter_md TEXT,\n  created_at TIMESTAMPTZ DEFAULT now(),\n  user_edited BOOLEAN DEFAULT FALSE\n);\n\n-- Embeddings (pgvector)\nCREATE TABLE IF NOT EXISTS job_embeddings (\n  job_id UUID PRIMARY KEY REFERENCES jobs(id) ON DELETE CASCADE,\n  title_vec vector(1536),\n  desc_vec  vector(1536)\n);\nCREATE INDEX IF NOT EXISTS idx_job_title_vec ON job_embeddings USING ivfflat (title_vec);\nCREATE INDEX IF NOT EXISTS idx_job_desc_vec  ON job_embeddings USING ivfflat (desc_vec);